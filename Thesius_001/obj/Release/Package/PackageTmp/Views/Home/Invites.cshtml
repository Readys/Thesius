@{
    ViewBag.Title = "Приглашения";
}
<br />
<h2>@ViewBag.Title</h2>
<h3></h3>
<br />
<div class="container">
    <div class="row">
        <div id="appInvite" class="col-md-6">
            <h4>Активные инвайты</h4>
            <table class="table col-sm-12" >
                <tr v-for="(item, index) in activeInvite">
                    <td>
                        <div class="col-sm-12">
                            @*<div class="form-control wizard-form-control d-flex align-items-center testing-code px-20px mb-10px">
                                <span class="title">Инвайткод:</span>&nbsp;
                                <span class="code text-red">{{ item.Code }}</span>&nbsp;
                                <span class="btn btn-sm btn-info text-white copy-btn ml-auto">
                                    Copy
                                </span>
                                <input class="justify-content-end" type="hidden" id="testing-code" :value="testingCode">
                            </div>*@
                            <div class="input-group mb-3">
                                <input type="text" id="testing-code" :value="item.Code" class="form-control" placeholder="" aria-label="" aria-describedby="button-addon2">
                                <button  @@click.stop.prevent="copyTestingCode(item)" class="btn btn-outline-secondary" type="button" id="button-addon2">Скопировать</button>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
            <h4>История инвайтов</h4>
            <table class="table table-striped col-sm-6">
                <tr v-for="(item, index) in viewInviteUser">
                    <td>
                        {{item.UserName}}
                    </td>
                    <td>
                        {{item.Code}}
                    </td>
                    <td>
                        {{new Date(parseInt(item.CreateDate.substr(6, item.CreateDate.length - 8), 10)).toLocaleString()}}
                    </td>
                    <td>
                        {{new Date(parseInt(item.CreateDate.substr(6, item.CreateDate.length - 8), 10)).toLocaleString()}}
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script>
    new Vue({
        el: "#appInvite",
    data: {
        testingCode: "1234",
        activeInvite:  @Html.Raw(Json.Encode(ViewBag.ActiveInvite)),
        viewInviteUser:  @Html.Raw(Json.Encode(ViewBag.ViewInviteUser)),
    },
    methods: {
        copyTestingCode(item) {
            $("#testing-code").val(item.Code);
            this.testingCode = item.Code;

            let testingCodeToCopy = document.querySelector('#testing-code');
            testingCodeToCopy.setAttribute('type', 'text');    // 不是 hidden 才能複製
            testingCodeToCopy.select();

          try {
            var successful = document.execCommand('copy');
            var msg = successful ? 'successful' : 'unsuccessful';
              alert('Инвайткод ' + item.Code + ' скопирован в буфер');
          } catch (err) {
            alert('Ошибка копирования');
          }

          /* unselect the range */
            //testingCodeToCopy.setAttribute('type', 'hidden');
            //window.getSelection().removeAllRanges();
        },
    },
    
});

</script>